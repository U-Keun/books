**Spring**의 핵심을 담당하는 건, *빈 팩토리* 또는 *어플리케이션 컨텍스트*라고 불리는, 예제로 만들었던 `DaoFactory`가 하는 일을 좀 더 일반화한 것이다.
##### 1.5.1 오브젝트 팩토리를 이용한 스프링 IoC
###### 어플리케이션 컨텍스트와 설정정보
**Spring**이 제어권을 가지고 직접 만들고 관계를 부여하는 오브젝트를 *빈*[^bean]이라고 한다. *자바빈* 또는 *엔터프라이즈 자바빈*[^EJB]에서 말하는 빈과 비슷한 오브젝트 단위의 어플리케이션 컴포넌트를 말한다. 동시에 *스프링 빈*은 스프링 컨테이너가 생성과 관계설정, 사용 등을 제어해주는 제어의 역전이 적용된 오브젝트를 가리키는 말이다.

*빈*의 생성과 관계설정 같은 제어를 담당하는 IoC 오브젝트를 *빈 팩토리*[^bean factory]라고 부른다. 보통 빈 팩토리보다는 이를 좀 더 확장한 *어플리케이션 컨텍스트*[^application context]를 주로 사용한다. 앞으로 두 용어를 같은 의미로서 함께 사용할 텐데, 빈 팩토리라고 말할 때는 *빈*을 생성하고 관계를 설정하는 IoC의 기본 기능에 초점을 맞춘 것이고, 어플리케이션 컨텍스트라고 말할 때는 어플리케이션 전반에 걸쳐 모든 구성요소의 제어 작업을 담당하는 IoC 엔진이라는 의미가 좀 더 부각된다고 보면 된다.

기존의 `DaoFactory` 코드에는 어떤 클래스의 오브젝트를 생성하고 어디에서 사용하도록 연결해줄 것인가 등의 설정정보가 Java 코드로 작성되어 있었다. 어플리케이션 컨텍스트는 직접 이런 정보를 담고 있지는 않지만, 별도로 설정정보를 담고 있는 무언가를 가져와서 활용한다. 빈 팩토리 또는 어플리케이션 컨텍스트가 사용하는 설정정보를 만드는 방법은 여러 가지가 있는데, 먼저 `DaoFactory`를 빈 팩토리가 사용할 수 있는 설정정보로 만들어보자.
###### DaoFactory를 사용하는 어플리케이션 컨텍스트
먼저 **Spring**이 빈 팩토리를 위한 오브젝트 설정을 담당하는 클래스라고 인식할 수 있도록 `DaoFactory`에 `@Configuration`이라는 어노테이션을 추가하고, 오브젝트를 만들어주는 메서드에는 `@Bean`이라는 어노테이션을 추가한다.
```java
@Configuration
public class DaoFactory {
	@Bean
	public UserDao userDao() {
		return new UserDao(connectionMaker());
	}

	@Bean
	public ConnectionMaker connectionMaker() {
		return new DConnectionMaker();
	}
}
```

이제 `DaoFactory`를 설정정보로 사용하는 어플리케이션 컨텍스트를 만들어보자. 어플리케이션 컨텍스트는 `ApplicationContext` 타입의 오브젝트이고, 그것을 구현한 클래스는 여러 가지가 있는데, 위의 `DaoFactory`처럼 `@Configuration`이 붙은 Java 코드를 설정정보로 사용하려면 `AnnotationConfigApplicationContext`를 이용하면 된다.
```java
public class UserDaoTest {
	public static void main(String[] args) throws ClassNotFoundException, SQLException {
		ApplicationContext context = new AnnotationConfigApplicationContext(DaoFactory.class);
		UserDao dao = context.getBean("userDao", UserDao.class);
		...
	}
}
```
`getBean()` 메서드는 `ApplicationContext`가 관리하는 오브젝트를 요청하는 메서드다. `getBean()` 메서드의 매개변수에는 사용되는 `"userDao"`는 `ApplicationContext`에 등록된 *빈*의 이름이고, 두 번째 매개변수는 반환할 타입을 의미한다.[^1]

##### 1.5.2 어플리케이션 컨텍스트의 동작방식
기존에 이용했던 오브젝트 팩토리에 대응되는 것이 **Spring**의 어플리케이션 컨텍스트다. 어플리케이션 컨텍스트는 `ApplicationContext` 인터페이스를 구현하는데, `ApplicationContext`는 빈 팩토리가 구현하는 `BeanFactory` 인터페이스를 상속했으므로 어플리케이션 컨텍스트는 일종의 빈 팩토리이다.

`DaoFactory`가 `UserDao`를 비롯한 DAO 오브젝트를 생성하고 DB 생성 오브젝트와 관계를 맺어주는 역할을 했다면, 어플리케이션 컨텍스트는 어플리케이션에서 IoC를 적용해서 관리할 모든 오브젝트에 대한 생성과 관계설정을 담당한다. `ApplicationContext`에는 `DaoFactory`와 다르게 직접 오브젝트를 생성하고 관계를 맺어주는 코드가 없고, 그런 생성정보와 연관관계 정보를 별도의 설정정보를 통해 얻는다.

위에서 언급했던 것처럼, `@Configuration`이 붙은 `DaoFactory`는 어플리케이션 컨텍스트의 IoC 설정정보다. 어플리케이션 컨텍스트는 `DaoFactory` 클래스를 설정정보로 등록해두고 `@Bean`이 붙은 메서드의 이름을 가져와 빈 목록을 만들어둔다. 클라이언트가 `getBean()` 메서드를 호출하면 자신의 빈 목록에서 요청한 이름이 있는지 찾고, 있다면 빈을 생성하는 메서드를 호출해서 오브젝트를 생성시킨 후 클라이언트에 돌려준다.

`DaoFactory`를 오브젝트 팩토리로 직접 사용했을 때와 비교해서 어플리케이션 컨텍스트를 사용했을 때 얻을 수 있는 장점은 다음과 같다.
- 클라이언트는 구체적인 팩토리 클래스를 알 필요가 없다.
  클라이언트가 필요한 오브젝트를 가져오려면 어떤 팩토리 클래스를 사용해야 할 지 알아야 하고, 필요할 때마다 오브젝트를 생성해야 하지만, 어플리케이션 컨텍스트를 사용하면 오브젝트 팩토리가 아무리 많아져도 이를 알아야 하거나 직접 사용할 필요가 없다.
- 어플리케이션 컨텍스트는 종합 IoC 서비스를 제공해준다.
  어플리케이션 컨텍스트는 오브젝트 생성과 다른 오브젝트와의 관계설정뿐만 아니라 오브젝트가 만들어지는 방식, 시점과 전략을 다르게 가져가도록 설정할 수도 있고, 부가적으로 자동생성, 오브젝트에 대한 후처리, 정보의 조합, 설정 방식의 다변화, 인터셉팅 등 오브젝트를 활용할 수 있는 다양한 기능을 제공한다. 또한, 빈이 사용할 수 있는 기반기술 서비스나 외부 시스템과의 연동 등을 컨테이너 차원에서 제공해주기도 한다.
- 어플리케이션 컨텍스트는 빈을 검색하는 다양한 방법을 제공한다.
  위에서 본 것처럼 `getBean()` 메서드는 빈의 이름을 이용해 빈을 찾을 수도 있고, 타입만으로 검색하거나 특별한 어노테이션 설정이 되어 있는 빈도 찾을 수 있다.
##### 1.5.3 스프링 IoC의 용어 정리
###### 빈(bean)
빈 또는 빈 오브젝트는 **Spring**이 IoC 방식으로 관리하는 오브젝트라는 뜻이다. **Spring**을 사용하는 어플리케이션에서 만들어지는 오브젝트 중에서 **Spring**이 직접 그 생성과 제어를 담당하는 오브젝트이다.(관리되는 오브젝트[^managed object]라고 부르기도 한다.)
###### 빈 팩토리(bean factory)
**Spring**의 IoC를 담당하는 핵심 컨테이너를 가리킨다. 빈을 등록하고, 생성하고, 조회하고, 돌려주고, 그 외에 부가적인 빈을 관리하는 기능을 담당한다. 보통은 빈 팩토리를 직접 사용하기 보다는 이것을 확장한 어플리케이션 컨텍스트를 이용한다.
###### 어플리케이션 컨텍스트(application context)
빈 팩토리를 확장한 IoC 컨테이너다. 빈 팩토리의 기본적인 기능에, **Spring**이 제공하는 각종 부가 서비스를 추가로 제공한다.
###### 설정정보/설정 메타정보(configuration metadata)
어플리케이션 컨택스트 또는 빈 팩토리가 IoC를 적용하기 위해 사용하는 메타정보를 말한다. IoC 컨테이너에 의해 관리되는 어플리케이션 오브젝트를 생성하고 구성할 때 사용된다.
###### IoC 컨테이너(IoC container)
IoC 방식으로 빈을 관리한다는 의미에서 어플리케이션 컨텍스트나 빈 팩토리를 컨테이너 또는 IoC 컨테이너라고도 한다. 때로는 '스프링에 빈을 등록하고'라는 식으로 말하는 경우도 있는데, 거기서 '스프링'은 컨테이너 또는 어플리케이션 컨텍스트를 가리키는 말이다.
###### 스프링 프레임워크
IoC 컨테이너, 어플리케이션 컨텍스트를 포함해서 **Spring**이 제공하는 모든 기능을 통틀어 말할 때 주로 사용한다.

#TobySpring #Spring 

[^1]: 메서드 `getBean()`의 반환 타입은 기본적으로 `Object` 타입인데, Java 5 이상의 *제네릭*[^generic] 메서드 방식을 사용해서 반환 타입을 지정해줄 수 있다.