전통적인 웹 어플리케이션 구조는 일반적으로 3계층 아키텍처(**웹 계층**, **도메인 계층**, **영속성 계층**)로 구성되어 있다.![[1.1.jpeg|center|300]]
**웹 계층**에서 요청을 받아 **도메인 계층**에 있는 서비스로 요청을 보내고, **도메인 계층**에서는 필요한 비즈니스 로직을 수행하고, 도메인 엔티티의 현재 상태를 조회하거나 변경하기 위해 **영속성 계층**의 컴포넌트를 호출한다.
### 계층형 아키텍처는 데이터베이스 주도 설계를 유도한다
위에서 볼 수 있듯이 **웹 계층**은 **도메인 계층**에 의존하고, **도메인 계층**은 **영속성 계층**에 의존하기 때문에 모든 것이 **영속성 계층**을 토대로 만들어진다. 다시 말하면, 영속성 및 데이터베이스의 구조를 먼저 생각하고, 이를 토대로 도메인 로직을 구현하는 것이 자연스럽게 느껴진다.(의존성의 방향에 따라서 구현하기 때문이다.)

하지만 비즈니스 관점에서는 이것이 적절하게 보이지 않을 수 있다. 왜냐하면 구현하는 사람의 관점에서 구현하기 편한 방식으로 생각하는 것으로 볼 수 있기 때문이다. 또는 영속성 및 데이터베이스의 구조를 완벽하게 설계해두지 않는다면 비즈니스 로직을 정확하게 반영하지 못할 수도 있다. 그렇기 때문에 비즈니스 로직, 또는 도메인 로직을 제대로 확인하고, 이것을 기반으로 **영속성 계층**이나 **웹 계층**을 만들어야 한다.
### 지름길을 택하기 쉬워진다
전통적인 계층형 아키텍처에서는 일반적으로 특정한 계층에서는 같은 계층에 있는 컴포넌트나 아래에 있는 계층에만 접근이 가능하다는 규칙을 따른다. 만약 상위 계층에 위치한 컴포넌트에 접근하고 싶다면 가장 쉬운 방법은 접근하고자 하는 컴포넌트를 같은 계층 또는 그보다 아래의 계층으로 내리는 것이다.

이 방법은 오랜 기간에 걸친 유지보수 후에는 아래쪽 계층이 비대해질 수 있는데, 아래쪽 계층이 비대해질수록 그 위 계층들에 복잡하게 의존하게 되고, 결과적으로는 상위 계층에서의 변경이 수많은 하위 계층의 변경을 낳을 수 있다. 이것은 바람직하지 않은 현상이다.
### 테스트하기 어려워진다
>*엔티티*의 필드를 단 하나만 조작하면 되는 경우에 웹 계층에서 바로 영속성 계층에 접근하면 도메인 계층을 건드릴 필요가 없지 않을까? - 책 6p

이 방법은 꽤나 그럴싸하게 보이지만, **도메인 계층**을 **웹 계층**에 구현하게 되면서 어플리케이션 전반에 걸쳐 책임이 섞이고 핵심 도메인 로직들이 퍼져나갈 가능성이 높다. 또한, **웹 계층**을 테스트할 때 **도메인 계층**뿐만 아니라 **영속성 계층**도 모킹[^mocking]해야 한다.

최근에 위의 질문에 관련된 새로운 개발 패러다임(?)을 유튜브에서 접했다. 간단한 요청을 프론트엔드 쪽에서 직접 데이터베이스 쪽으로 요청하도록 설계하는 방식이었는데, 백엔드 쪽의 코드를 전혀 작성하지 않고 기능을 만드는 방식이어서 이 책에서 우려한 문제를 피할 수 있기 때문에 꽤나 유용할 수 있다는 생각이 들었다.
- [supabase 관련 유튜브 링크](https://www.youtube.com/watch?v=f8inSwfOVZc&pp=ygUIc3VwYWJhc2U%3D)
### 유스케이스를 숨긴다
계층형 아키텍처에서는 도메인 로직이 여러 계층에 걸쳐 흩어지거나 여러 개의 유스케이스를 담당하는 아주 넓은 서비스가 만들어지기도 한다. 어떤 경우든 기능을 변경하기 위해서는 도메인 로직과 관련된 코드를 찾는 것이 귀찮고 수고로운 일이 될 것이고, 이것은 효율적이지 않다. 
>고도로 특화된 좁은 도메인 서비스가 유스케이스 하나씩만 담당하게 한다면 이런 작업들이 얼마나 수월해질까? - 책 8p
### 동시 작업이 어려워진다
위에서 계층형 아키텍처의 특징들을 다시 살펴보면 여러 개발자가 동시에 작업하는 것이 쉽지 않다는 것을 알 수 있다. 모든 것이 **영속성 계층**을 토대로 만들어지기 때문에 **영속성 계층**을 먼저 개발해야 하고, 그 다음에 **도메인 계층**, **웹 계층**을 순서대로 만들어야 한다. 또 넓은 서비스가 있다면 서로 다른 기능을 동시에 작업하기가 더 어렵다. 작업은 보통 Git을 통한 버전 관리 시스템을 사용하는데, 병합 충돌이 날 가능성이 높기 때문이다.
### 유지보수 가능한 소프트웨어를 만드는 데 어떻게 도움이 될까?
계층형 아키텍처는 올바르게 구축하고, 적절한 규칙을 적용하면 유지보수하기 쉽고 코드를 쉽게 변경하고 추가할 수 있지만, 많은 것들이 잘못된 방향으로 흘러가도록 용인하기도 한다. 

#CleanArchitecture