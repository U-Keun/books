DBMS는 데이터를 메모리와 디스크에 저장합니다. *In-memory* DBMS는 데이터를 기본적으로 메모리에 저장하고 복구나 로깅을 위해 디스크를 사용합니다. *disk-based* DBMS는 대부분의 데이터를 디스크에 저장하고, 메모리는 캐싱 용도 또는 일시적인 저장소로 사용합니다. 두 시스템 모두 디스크를 어느 정도 사용하지만, In-memory DBMS는 데이터를 거의 독점적으로 RAM에 저장합니다.

메모리에 접근하는 것은 디스크에 접근하는 것보다 몇 배 더 빠르기 때문에, 메모리를 기본 저장소로 사용할 수밖에 없고, 메모리 가격도 낮아지고 있어서 경제적입니다. 하지만 SSD나 HDD 같은 영구 저장 장치에 비해 RAM 가격은 여전히 비쌉니다.

In-memory DBMS는 기본 저장 방식 뿐만 아니라 데이터 구조, 조직 및 최적화 기술도 disk-based DBMS와는 다릅니다. 

데이터베이스는 비교적 저렴한 접근 비용과 접근 세분성[^1] 때문에 메모리를 기본 데이터 저장소로 사용합니다. 메모리에 대한 프로그래밍도 디스크에 대한 프로그래밍보다 훨씬 간단합니다. 운영체제는 메모리 관리를 추상화해서 임의의 크기의 메모리 청크를 할당하고 해제하는 방식으로 프로그래밍할 수 있습니다. 디스크에 대한 프로그래밍에서는 데이터 참조, 직렬화 형식, 해제된 메모리 및 조각화를 수동으로 관리해야 합니다.

In-memory DBMS의 한계는 RAM 변동성(내구성 부족)과 비용입니다. RAM에 저장되는 데이터는 비영구적이기 때문에 소프트웨어 오류, 충돌, 하드웨어 장애, 정전 등으로 데이터 손실이 발생할 수 있습니다. 내구성을 보장하는 몇 가지 방법이 있지만(끊김 없는 전원 공급 장치, 배터리 지원 RAM 등), 보통 추가적인 하드웨어 자원과 운영 전문 지식이 필요합니다. 실제로, 디스크는 유지 관리가 쉽고 가격도 훨씬 저렴합니다.

*NVM*[^Non-Volatile Memory] 기술의 가용성과 인기가 높아짐에 따라 상황이 바뀔 것으로 보입니다. NVM 스토리지는 읽기 및 쓰기 대기 시간 간의 비대칭을 최소화해서 읽기 및 쓰기 성능을 더욱 향상시키며, 바이트 주소를 지정하는 액세스를 허용합니다.
##### Durability in Memory-Based Stores
In-memory DBMS는 데이터의 내구성 및 휘발성 데이터의 손실을 방지하기 위해 디스크에 백업 데이터를 관리합니다. 어떤 데이터베이스들은 내구성을 보장하지 않고 독점적으로 메모리에 저장하기도 하지만, 이 책에서 그 부분에 대해서는 다루지 않을 것입니다.

작업이 완료된 것으로 간주되기 전에, 작업 결과를 순차적 로그 파일에 기록해야 합니다. (시작하는 동안 또는 충돌 후에) 완료 로그 내용이 반복적으로 기록되는 것을 막기 위해 In-memory 저장소에서는 *백업 복사본*을 관리합니다. 백업 복사본은 정렬된 디스크 기반 구조로 관리되고, 이 구조에 대한 수정은 비동기적으로(클라이언트 요청과 분리되어) 수행됩니다. 그리고 I/O 작업의 수를 줄이기 위해 일괄 처리로 적용됩니다. 데이터베이스의 데이터들은 백업과 로그를 통해 복구될 수 있습니다.

로그 기록은 일반적으로 일괄 백업에 적용됩니다. 로그 기록의 일괄 처리가 수행된 후에, 백업 데이터는 특정 시점의 데이터베이스 *스냅샷*을 가지고 있고, 이 시점 이전의 로그 내용은 지워질 수 있습니다. 이 과정을 *checkpointing*이라고 부릅니다. 이것은 백업이 업데이트될 때까지 클라이언트가 차단할 필요 없이 디스크 상에  데이터베이스 내용을 로그 항목으로 최신 상태로 유지하여 복구 시간을 단축합니다.

> NOTE
> In-memory 데이터베이스는 거대한 페이지 캐시를 가진 *on-disk* 데이터베이스라고 할 수 있습니다. 페이지가 메모리에 캐싱되더라도 직렬화 형식[^2] 및 데이터 레이아웃[^3]은 추가 오버헤드를 발생시키며, In-memory 저장소와 동일한 정도의 최적화를 허용하지 않습니다.

디스크 기반 데이터베이스는 디스크 접근에 최적화된 특별한 저장소 구조를 사용합니다. 메모리에서는 포인터를 통해 빠르게 위치를 찾을 수 있고, 랜덤 메모리 접근도 랜덤 디스크 접근보다 상당히 빠릅니다. 디스크 저장소 구조는 넓고 짧은 트리 구조를 가지는 반면, 메모리에서는 메모리 기반 구현을 통해 더 최적화된 다양한 데이터 구조를 사용할 수 있습니다. 하지만 이것은 디스크에서는 구현이 불가능하거나 어렵습니다. 또한, 디스크에서 다양한 크기의 데이터를 다루는 것에도 주의가 필요합니다. 하지만 메모리에서는 포인터를 통해 값을 참조하는 것으로 충분합니다. 

일부 사용 사례를 보면, 전체 데이터셋이 메모리에 적합할 것이라고 가정하는 것은 합리적입니다. 학교의 학생 기록, 기업의 고객 기록 또는 온라인 상점의 재고와 같은 일부 데이터 세트는 실제 표현에 의해 제한됩니다. 각 기록은 몇 Kb 이내로 제한되며, 그 수는 제한됩니다.

#DataBase #DataBaseInternals 

[^1]: 데이터에 대한 접근을 제어하는 정도의 세밀함을 의미합니다. 예를 들면, 파일 시스템에서는 파일이나 디렉토리 단위로 접근 권한을 설정할 수 있는 반면, 데이터베이스에서는 테이블, 레코드, 특정 필드 단위로 접근을 제어할 수 있습니다.
[^2]: 데이터가 저장 매체에 저장되거나 전송될 때 사용되는 인코딩 방법으로, 디스크에 저장된 데이터를 메모리로 로드하거나 반대로 저장할 때 사용됩니다.
[^3]: 데이터가 저장 매체에 어떻게 배치되는지를 설명합니다. 이것은 데이터 접근 패턴과 관련이 있습니다.